/**
 * PotatoParticles
 * author: dobrapyra (Michał Zieliński)
 * version "0.1.1"
 */
window.PotatoParticles=function(t){var e={};function i(a){if(e[a])return e[a].exports;var n=e[a]={i:a,l:!1,exports:{}};return t[a].call(n.exports,n,n.exports,i),n.l=!0,n.exports}return i.m=t,i.c=e,i.d=function(t,e,a){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:a})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var a=Object.create(null);if(i.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(a,n,function(e){return t[e]}.bind(null,n));return a},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=1)}([function(t,e){t.exports=window.PIXI},function(t,e,i){"use strict";i.r(e);var a=i(0);function n(t,e){for(var i=0;i<e.length;i++){var a=e[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}var r=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.isImageLoaded=!1,this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d")}var e,i,a;return e=t,(i=[{key:"load",value:function(t){var e=this;return this.isImageLoaded=!1,new Promise((function(i){var a=new Image;a.onload=function(t){var a=t.target;e.onImageLoaded(a),i(a)},a.src=t}))}},{key:"onImageLoaded",value:function(t){this.image=t,this.width=this.image.width,this.height=this.image.height,this.isImageLoaded=!0}},{key:"checkImage",value:function(){return!!this.isImageLoaded}},{key:"imageToDots",value:function(t){if(!this.checkImage())return null;var e=this.image,i=t.width,a=void 0===i?e.width:i,n=t.height,r=void 0===n?e.height:n,s=t.pixelSize,o=void 0===s?1:s,h=t.pixelFilter,l=void 0===h?function(t){return t.a>=.4}:h,c=t.pixelMap,u=void 0===c?function(t){return t}:c,d=Math.ceil(a/o),v=Math.ceil(r/o);return this.canvas.setAttribute("width",d),this.canvas.setAttribute("height",v),this.imageToData(e,{canvasWidth:d,canvasHeight:v,pixelSize:o,pixelFilter:l,pixelMap:u})}},{key:"imageToData",value:function(t,e){var i=e.canvasWidth,a=e.canvasHeight,n=e.pixelSize,r=e.pixelFilter,s=e.pixelMap;this.ctx.clearRect(0,0,i,a),this.drawImageCover(t,i,a);for(var o=this.ctx.getImageData(0,0,i,a).data,h=[],l=0;l<a;l++)for(var c=0;c<i;c++){var u=4*(l*i+c),d={x:c*n,y:l*n,r:o[u+0]/255,g:o[u+1]/255,b:o[u+2]/255,a:o[u+3]/255};r(d)&&(Object.assign(d,s(d)),h.push(d))}return h}},{key:"drawImageCover",value:function(t,e,i){var a=Math.min(e/t.width,i/t.height),n={width:t.width*a,height:t.height*a},r={x:(e-n.width)/2,y:(i-n.height)/2};this.ctx.drawImage(t,0,0,t.width,t.height,r.x,r.y,n.width,n.height)}}])&&n(e.prototype,i),a&&n(e,a),t}();function s(t,e){for(var i=0;i<e.length;i++){var a=e[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}var o=function(){function t(e,i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.x=e,this.y=i}var e,i,a;return e=t,a=[{key:"add",value:function(t,e){var i=t.clone();return i.add(e),i}},{key:"subtract",value:function(t,e){var i=t.clone();return i.subtract(e),i}},{key:"multiply",value:function(t,e){var i=t.clone();return i.multiply(e),i}},{key:"divide",value:function(t,e){var i=t.clone();return i.divide(e),i}},{key:"roundAxis",value:function(t){return Math.round(1e5*t)/1e5}}],(i=[{key:"set",value:function(t,e){this.x=t,this.y=e}},{key:"setX",value:function(t){this.x=t}},{key:"setY",value:function(t){this.y=t}},{key:"add",value:function(e){this.x=t.roundAxis(this.x+e.x),this.y=t.roundAxis(this.y+e.y)}},{key:"subtract",value:function(e){this.x=t.roundAxis(this.x-e.x),this.y=t.roundAxis(this.y-e.y)}},{key:"multiply",value:function(e){this.x=t.roundAxis(this.x*e),this.y=t.roundAxis(this.y*e)}},{key:"divide",value:function(e){this.x=t.roundAxis(this.x/e),this.y=t.roundAxis(this.y/e)}},{key:"value",value:function(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))}},{key:"normalize",value:function(){var t=this.value();0!==t?(this.x/=t,this.y/=t):(this.x=0,this.y=0)}},{key:"clone",value:function(){return new t(this.x,this.y)}}])&&s(e.prototype,i),a&&s(e,a),t}();function h(t,e){for(var i=0;i<e.length;i++){var a=e[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}var l=function(){function t(e,i){var a=i.x,n=i.y,r=i.mass,s=void 0===r?1:r,h=i.texture,l=i.color,c=i.alpha,u=i.delay;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.position=new o(a,n),this.velocity=new o(0,0),this.acceleration=new o(0,0),this.force=new o(0,0),this.mass=s,this.target=this.position.clone(),this.waitFrames=60*u,this.waiting=this.waitFrames>0,e&&(this.sprite=this.createSprite({texture:h,color:l,alpha:c}),e.addChild(this.sprite))}var e,i,n;return e=t,(i=[{key:"createSprite",value:function(t){var e=t.texture,i=t.color,n=t.alpha,r=new a.Sprite(e);return r.tint=i,r.alpha=n,r.anchor.set(.5),r.position.set(this.position.x,this.position.y),r}},{key:"addForce",value:function(t){t&&this.force.add(t)}},{key:"setTarget",value:function(t){this.target=t}},{key:"getForceToTarget",value:function(){if(!this.target)return null;var t=o.subtract(this.target,this.position);return t.multiply(.04),t}},{key:"getMouseForce",value:function(t){var e=o.subtract(t,this.position),i=e.value();e.normalize();var a=120/i,n=a*a-.04,r=n<0?0:.8*n;return e.multiply(-r),e}},{key:"update",value:function(t){if(this.waiting){if(this.waitFrames-=t,this.waitFrames>0)return;return this.waitFrames=0,this.waiting=!1,void this.force.set(0,0)}this.acceleration.set(this.force.x,this.force.y),this.acceleration.divide(this.mass),this.velocity.add(this.acceleration),this.position.add(this.velocity),this.force.set(0,0)}},{key:"render",value:function(){this.sprite&&this.sprite.position.set(this.position.x,this.position.y)}},{key:"destroy",value:function(){this.sprite.destroy({texture:!0})}}])&&h(e.prototype,i),n&&h(e,n),t}();function c(t,e){for(var i=0;i<e.length;i++){var a=e[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}var u=function(){function t(e){var i=this,a=e.imageEl,n=e.pixelSize,s=void 0===n?10:n,o=e.particleSize,h=void 0===o?6:o,l=e.resistance,c=void 0===l?-.7:l,u=e.minMass,d=void 0===u?4:u,v=e.massRand,p=void 0===v?2:v,f=e.delayRand,y=void 0===f?.4:f,g=e.pixelFilter,m=e.pixelMap,x=e.particleInit,w=e.mouseInteraction,k=void 0===w||w;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.imageEl=a,this.pixelSize=s,this.particleSize=h,this.resistance=c,this.minMass=d,this.massRand=p,this.delayRand=y,this.pixelFilter=g,this.pixelMap=m,this.particleInit=x,this.mouseInteraction=k;var b=[];this.imageHelper=new r,b.push(this.imageHelper.load(a.src)),Promise.all(b).then((function(){i.onLogoLoaded()}))}var e,i,n;return e=t,(i=[{key:"onLogoLoaded",value:function(){this.width=this.imageEl.naturalWidth||this.imageEl.width,this.height=this.imageEl.naturalHeight||this.imageEl.height,this.particlesData=this.imageHelper.imageToDots({width:this.width,height:this.height,pixelSize:this.pixelSize,pixelFilter:this.pixelFilter,pixelMap:this.pixelMap}),this.mouseVector=new o(0,0),this.initRenderer(),this.initParticles(),this.renderer.render(this.stage),this.startLoop(),this.calculateScale(),this.bindEvents(),this.setParticlesTargets()}},{key:"initRenderer",value:function(){a.utils.skipHello(),this.renderer=new a.Renderer({width:this.width,height:this.height,transparent:!0}),this.renderer.context.mozImageSmoothingEnabled=!1,this.renderer.context.webkitImageSmoothingEnabled=!1,this.canvasEl=this.renderer.view,this.imageEl.style.display="none",this.imageEl.parentElement.appendChild(this.canvasEl),this.stage=new a.Container,this.particleContainer=new a.Container,this.stage.addChild(this.particleContainer),this.tick=this.tick.bind(this),this.ticker=new a.Ticker,this.ticker.add(this.tick)}},{key:"initParticles",value:function(){this.particles=[];for(var t=this.particlesData.length,e=this.getShared(),i=this.particleInit||function(){return{}},n=this.createCircleTexture(e.particleSize/2,16777215,1),r=0;r<t;r++){var s=this.particlesData[r],o=a.utils.rgb2hex([s.r,s.g,s.b]);this.particles.push(new l(this.particleContainer,Object.assign({x:e.avgX,y:e.avgY,mass:Math.random()*e.massRand+e.minMass,texture:n,color:o,alpha:s.a,delay:(e.rangeY-(s.y-e.minY))*(2/e.rangeY)+Math.random()*e.delayRand},i(s,e))))}}},{key:"getShared",value:function(){for(var t=this.particlesData.length,e=this.particleSize,i=this.minMass,a=this.massRand,n=this.delayRand,r=0,s=0,o=this.particlesData[0].x,h=0,l=this.particlesData[0].y,c=0,u=0;u<t;u++){var d=this.particlesData[u];r+=d.x,s+=d.y,d.x<o&&(o=d.x),d.x>h&&(h=d.x),d.y<l&&(l=d.y),d.y>c&&(c=d.y)}return{width:this.width,height:this.height,halfWidth:this.width/2,halfHeight:this.height/2,particlesCount:t,particleSize:e,minMass:i,massRand:a,delayRand:n,minX:o,minY:l,maxX:h,maxY:c,sumX:r,sumY:s,avgX:r/t,avgY:s/t,rangeX:h-o,rangeY:c-l}}},{key:"createCircleTexture",value:function(t,e,i){var n=new a.Graphics;n.beginFill(e,i),n.drawCircle(0,0,t),n.endFill();var r=this.renderer.generateTexture(n);return n.clear(),n.destroy(),r}},{key:"calculateScale",value:function(){var t=this.canvasEl.getBoundingClientRect();this.scale=this.width/t.width}},{key:"setParticlesTargets",value:function(){for(var t=this.particlesData.length,e=0;e<t;e++){var i=this.particlesData[e];this.particles[e].setTarget(new o(i.x,i.y))}}},{key:"bindEvents",value:function(){window.addEventListener("resize",this.onResize.bind(this)),this.mouseInteraction&&window.addEventListener("mousemove",this.onMouseMove.bind(this))}},{key:"onResize",value:function(){this.calculateScale()}},{key:"onMouseMove",value:function(t){var e=this.canvasEl.getBoundingClientRect();this.mouseVector.set(t.clientX-e.left,t.clientY-e.top),this.mouseVector.multiply(this.scale)}},{key:"startLoop",value:function(){this.ticker.start()}},{key:"stopLoop",value:function(){this.ticker.stop()}},{key:"tick",value:function(t){this.update(t),this.render(1)}},{key:"update",value:function(t){for(var e=this.particles.length,i=0;i<e;i++){var a=this.particles[i];a.addForce(a.getForceToTarget()),this.mouseInteraction&&a.addForce(a.getMouseForce(this.mouseVector)),a.addForce(o.multiply(a.velocity,this.resistance)),a.update(t)}}},{key:"render",value:function(t){for(var e=this.particles.length,i=0;i<e;i++)this.particles[i].render(t);this.renderer.render(this.stage)}},{key:"destroy",value:function(){this.ticker&&(this.stopLoop(),this.ticker.remove(this.tick),this.ticker.destroy());for(var t=this.particles.length,e=0;e<t;e++)this.particles[e].destroy();this.stage&&this.stage.destroy({children:!0,texture:!0}),this.renderer&&this.renderer.destroy()}}])&&c(e.prototype,i),n&&c(e,n),t}();e.default=u}]).default;